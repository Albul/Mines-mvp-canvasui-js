if("undefined"==typeof mines||!mines)var mines={};"undefined"!=typeof mines.utils&&mines.utils||(mines.utils={});function extend(a,e){var c=function(){};c.prototype=e.prototype;a.prototype=new c;a.prototype.constructor=a;a.superclass=e.prototype}Array.prototype.clone=function(){return this.slice(0)};
(function(){mines.utils.EventDispatcher=function(){var a={any:[]},e=function(c,b,d){var h=a.hasOwnProperty(b)?b:"any";b=a[h].clone();for(var h=a[h],f=0,e=b.length;f<e;f++)if("dispatch"===c)b[f](d);else h[f]===d&&h.splice(f,1)};this.addEventListener=function(c,b){c=c||"any";"undefined"===typeof a[c]&&(a[c]=[]);a[c].push(b)};this.removeEventListener=function(a,b){e("remove",a,b)};this.dispatchEvent=function(a,b){e("dispatch",a,b)}}})();
(function(){mines.utils.Event={LOADED:"loaded",GAME_WON:"gameWon",GAME_LOST:"gameLost",TIME_CHANGED:"timeChanged",DATA_MODIFIED:"dataModified",CELLS_OPENED:"cellsOpened",CELL_MARKED:"cellsMarked",CELL_CLICK:"cellClick",CELL_MOUSE_DOWN:"cellMouseDown",CELL_MOUSE_UP:"cellMouseUp",CELL_RIGHT_CLICK:"cellRightClick",BUTTON_CLICK:"buttonClick"}})();
(function(){mines.utils.Animation=function(a){this.canvas=document.getElementById(a);this.context=this.canvas.getContext("2d");this.frame=this.lastTime=this.startTime=this.timeInterval=this.t=0;this.animating=!1;this.instance=null;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}()};mines.utils.Animation.prototype=
{getContext:function(){return this.context},getCanvas:function(){return this.canvas},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},setStage:function(a){this.stage=a;this.t=0},isAnimating:function(){return this.animating},getFrame:function(){return this.frame},getTimeInterval:function(){return this.timeInterval},getTime:function(){return this.t},getFps:function(){return 0<this.timeInterval?1E3/this.timeInterval:0},start:function(){this.animating=!0;this.lastTime=
this.startTime=(new Date).getTime();void 0!==this.stage&&this.stage();this.animationLoop()},stop:function(){this.animating=!1},animationLoop:function(){if(this.animating){var a=this;this.frame++;var e=(new Date).getTime();this.timeInterval=e-this.lastTime;this.t+=this.timeInterval;this.lastTime=e;void 0!==this.stage&&this.stage();this.animating&&requestAnimFrame(function(){a.animationLoop()})}}}})();
(function(){mines.utils.ExtMath={getRandomInt:function(a,e){return Math.floor(Math.random()*(e-a+1))+a}}})();
(function(){var a=mines.utils.ExtMath,e=function(c,b,d){for(var h,f,e=d;e>=b;e--)h=a.getRandomInt(b,d),f=c[e],c[e]=c[h],c[h]=f;return c};mines.utils.ExtArray={create:function(a,b){if("undefined"==typeof b){for(var d=Array(a),h=a;h--;)d[h]=h+1;return d}d=Array(a);for(h=a;h--;)d[h]=b;return d},createRandom:function(c,b,d,h){for(var f=Array(d),e=d;e--;){for(d=a.getRandomInt(c,b);-1!=f.indexOf(d)||-1!=h.indexOf(d);)d=a.getRandomInt(c,b);f[e]=d}return f},shuffle:function(a,b,d){return"undefined"==typeof b||
"undefined"==typeof d?e(a,0,a.length-1):e(a,b,d)},amount:function(a,b){for(var d=0,e=a.length;e--;)a[e]==b&&d++;return d}}})();
(function(){var a=mines.utils.ExtMath,e=function(a,b){for(var d=a.length,e=a[0].length;d--;){for(;e--;)a[d][e]=b;e=a[0].length}};mines.utils.Matrix={create:function(a,b,d){a=Array(a);for(var h=a.length;h--;)a[h]=Array(b);"undefined"!=typeof d&&e(a,d);return a},fill:function(a,b){e(a,b)},fillRandom:function(c,b,d){for(var e=c.length-1,f=c[0].length-1,l,n;b;){l=a.getRandomInt(0,e);for(n=a.getRandomInt(0,f);c[l][n]==d;)l=a.getRandomInt(0,e),n=a.getRandomInt(0,f);c[l][n]=d;b--}}}})();
(function(){mines.utils.Collision={hitTestPoint:function(a,e,c){return a.x<e&&a.y<c&&a.x+a.width>e&&a.y+a.height>c?!0:!1}}})();(function(){mines.utils.Dom={getElementPosition:function(a){for(var e="",c=0,b=0;"object"==typeof a&&"undefined"!=typeof a.tagName;)b+=a.offsetTop,c+=a.offsetLeft,e=a.tagName.toUpperCase(),"BODY"==e&&(a=0),"object"==typeof a&&"object"==typeof a.offsetParent&&(a=a.offsetParent);return{x:c,y:b}}}})();mines.Constants={MINE:-1,ZERO:0,CLOSED_STATE:0,OPENED_STATE:1,MARKED_STATE:3,OVERFLOW:!1,STATE_DURING:0,STATE_WON:1,STATE_LOST:2,FACE_SMILE:1,FACE_WORRIED:2,FACE_COOL:3,FACE_SAD:4,FACE_WIN:5,BUTTON_HEIGHT:50};
(function(){mines.ModelGame=function(){mines.ModelGame.superclass.constructor.call(this);var a=mines.Constants,e=mines.utils.Matrix,c=mines.utils.Event,b,d,h=this,f,l,n,g,m,k,r,s,q,v,t,u,w,x=function(a,c){for(var b,d,f=1,e=[];8>=f;){switch(f){case 1:b=a-1;d=c;break;case 2:b=a+1;d=c;break;case 3:b=a;d=c-1;break;case 4:b=a;d=c+1;break;case 5:b=a-1;d=c-1;break;case 6:b=a-1;d=c+1;break;case 7:b=a+1;d=c-1;break;case 8:b=a+1,d=c+1}var h;h=0<=b&&b<v&&0<=d&&d<q?!0:!1;h&&e.push(b,d);f++}return e},B=function(a,
b){var d=0,c,f,e;e=x(a,b);for(var g=0,t=e.length;g<t;g+=2)c=e[g],f=e[g+1],h.isMine(c,f)&&d++;return d},y=function(a,d){z(a,d);if(h.isZero(a,d)||h.isMine(a,d)){var c,b,f;f=x(a,d);for(var e=0,g=f.length;e<g;e+=2)c=f[e],b=f[e+1],h.isMine(c,b)||h.isOpened(c,b)||y(c,b)}},z=function(c,b){h.isOpened(c,b)||(u--,d[c][b]=a.OPENED_STATE,w.push([c,b]))},A=function(){n=new Date;n>l&&(l=n,k=(l-f)/1E3,r=Math.floor(k/60),s=Math.floor(k%60),m=10<=r?r:"0"+r,m+=":",m+=10<=s?s:"0"+s,h.dispatchEvent(c.TIME_CHANGED,m));
g||setTimeout(A,1E3)};this.init=function(c,g,k){q=c;v=g;t=k;l=f=new Date;setTimeout(A,1E3);d=e.create(v,q,a.CLOSED_STATE);b=e.create(v,q,a.ZERO);e.fillRandom(b,t,a.MINE);u=v*q;w=[];c=q;for(g=v;c--;){for(;g--;)h.isMine(c,g)||h.setContentCell(c,g,B(c,g));g=q}};this.tryOpenCell=function(b,d){this.isOpened(b,d)||this.isMarked(b,d)||(w=[],z(b,d),this.isZero(b,d)&&y(b,d),this.dispatchEvent(c.CELLS_OPENED,w),this.isMine(b,d)&&(g=new Date,this.setStateGame(a.STATE_LOST),h.dispatchEvent(c.GAME_LOST)),u==this.getMines()&&
(g=new Date,this.setStateGame(a.STATE_WON),this.dispatchEvent(c.GAME_WON)))};this.tryMarkCell=function(b,d){this.isOpened(b,d)||(this.isMarked(b,d)?this.setStateCell(b,d,a.CLOSED_STATE):this.setStateCell(b,d,a.MARKED_STATE),w=[[b,d]],this.dispatchEvent(c.CELL_MARKED,w))};this.isOpened=function(b,c){return d[b][c]==a.OPENED_STATE};this.isMine=function(d,c){return b[d][c]==a.MINE};this.isMarked=function(b,c){return d[b][c]==a.MARKED_STATE};this.isZero=function(c,d){return b[c][d]==a.ZERO};this.getRows=
function(){return v};this.getCols=function(){return q};this.getMines=function(){return t};this.getContentCell=function(a,c){return b[a][c]};this.getTime=function(){if(g)return(g.getTime()-f.getTime())/1E3};this.setContentCell=function(a,c,d){b[a][c]=d};this.setStateCell=function(a,c,b){d[a][c]=b};this.setStateGame=function(a){};this.quitGame=function(){g=new Date;this.setStateGame(a.STATE_LOST)}};extend(mines.ModelGame,mines.utils.EventDispatcher)})();var CONTEXT=document.getElementById("canvas").getContext("2d");CanvasRenderingContext2D.prototype.roundRect=function(a,e,c,b,d,h,f){c<2*d&&(d=c/2);b<2*d&&(d=b/2);this.beginPath();this.moveTo(a+d,e);this.arcTo(a+c,e,a+c,e+b,d);this.arcTo(a+c,e+b,a,e+b,d);this.arcTo(a,e+b,a,e,d);this.arcTo(a,e,a+c,e,d);this.closePath();h&&this.fill();f&&this.stroke()};"undefined"!=typeof mines.view&&mines.view||(mines.view={});
(function(){var a=CONTEXT;mines.view.Cell=function(a,c,b,d){this.i=a;this.j=c;this.x=b;this.y=d};mines.view.Cell.prototype={TOP_COLOR_OPENED:"#fcfcfc",BOTTOM_COLOR_OPENED:"#e1dfde",TOP_COLOR_CLOSED:"#8cb0dc",BOTTOM_COLOR_CLOSED:"#7aa1d2",MINE_COLOR_FILL:"#7B7B7B",MINE_COLOR_STROKE:"#121212",COLORS_NUMBER:"#0000FF #00A000 #FF0000 #00007F #A00000 #00CCFF #A000A0 #000000".split(" "),SIZE:60,FONT_SIZE:54,THORN_HEIGHT:8,width:60,height:60,imgFlag:null,imgMine:null,drawMine:function(){var e=this.x+this.SIZE/
2,c=this.y+this.SIZE/2,b=this.SIZE/3.5,d=2*Math.PI,h,f,l,n;h=a.createRadialGradient(e-4,c-2,0,e-4,c-2,b);h.addColorStop(0,this.MINE_COLOR_FILL);h.addColorStop(1,this.MINE_COLOR_STROKE);a.beginPath();a.arc(e,c,b,0,2*Math.PI,!1);a.fillStyle=h;a.fill();a.lineWidth=5;a.strokeStyle=this.MINE_COLOR_STROKE;for(a.stroke();d;)h=e+b*Math.cos(d),f=c+b*Math.sin(d),l=e+(b+this.THORN_HEIGHT)*Math.cos(d),n=c+(b+this.THORN_HEIGHT)*Math.sin(d),a.beginPath(),a.moveTo(h,f),a.lineTo(l,n),a.stroke(),d-=Math.PI/4;a.moveTo(e,
c-this.THORN_HEIGHT/4);a.lineTo(e,c+this.THORN_HEIGHT/4);a.stroke()},drawFlag:function(){a.drawImage(this.imgFlag,this.x+2,this.y+2)},drawStrikeoutFlag:function(){a.save();a.lineWidth=6;a.strokeStyle=this.MINE_COLOR_STROKE;a.lineCap="round";a.beginPath();a.moveTo(this.x+5,this.y+5);a.lineTo(this.x+this.SIZE-8,this.y+this.SIZE-8);a.moveTo(this.x+this.SIZE-8,this.y+5);a.lineTo(this.x+5,this.y+this.SIZE-8);a.stroke();a.closePath();a.restore()},draw:function(e,c,b,d){var h=a.createLinearGradient(this.x,
this.y,this.x,this.y+this.SIZE);a.save();c?(h.addColorStop(0,this.TOP_COLOR_OPENED),h.addColorStop(1,this.BOTTOM_COLOR_OPENED)):(h.addColorStop(0,this.TOP_COLOR_CLOSED),h.addColorStop(1,this.BOTTOM_COLOR_CLOSED));a.lineWidth=1;a.fillStyle=h;a.strokeStyle="#7d838c";a.roundRect(this.x,this.y,this.SIZE,this.SIZE,6,!0,!1);a.roundRect(this.x-1,this.y-1,this.SIZE,this.SIZE,6,!1,!0);c?("undefined"!=typeof e&&0<e&&(a.font="bold "+this.FONT_SIZE+"px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle=
this.COLORS_NUMBER[(e-1)%this.COLORS_NUMBER.length],a.fillText(e.toString(),this.x+this.SIZE/2,this.y+this.SIZE/2)),b&&this.drawMine()):d&&this.drawFlag();a.restore()},load:function(){this.imgFlag=new Image;this.imgFlag.src="../asset/flag.png";this.imgMine=new Image;this.imgMine.src="../asset/mine.png"}};mines.view.Cell.prototype.load()})();
(function(){mines.view.Face=function(a,e){mines.view.Face.superclass.constructor.call(this);var c=mines.Constants,b=mines.utils.Event,d=0,h=this,f=CONTEXT,l=null,n=null,g=null,m=null,k=null;this.x=a;this.y=e;this.SIZE=50;var r=function(){d++;5==d&&h.dispatchEvent(b.LOADED)};this.load=function(){l=new Image;l.src="../asset/face-smile.png";l.onload=r;n=new Image;n.src="../asset/face-worried.png";n.onload=r;m=new Image;m.src="../asset/face-cool.png";m.onload=r;g=new Image;g.src="../asset/face-sad.png";
g.onload=r;k=new Image;k.src="../asset/face-win.png";k.onload=r};this.draw=function(a){f.clearRect(this.x,this.y,this.SIZE,this.SIZE);switch(a){case c.FACE_SMILE:f.drawImage(l,this.x,this.y);break;case c.FACE_WORRIED:f.drawImage(n,this.x,this.y);break;case c.FACE_COOL:f.drawImage(m,this.x,this.y);break;case c.FACE_SAD:f.drawImage(g,this.x,this.y);break;case c.FACE_WIN:f.drawImage(k,this.x,this.y)}}};mines.view.Face.SIZE=50;extend(mines.view.Face,mines.utils.EventDispatcher)})();
(function(){mines.view.Clock=function(a,e){var c=CONTEXT,b=0,d;this.updateTime=function(h){c.save();c.lineWidth=2;c.strokeStyle="#9c9c9c";c.fillStyle=d;c.roundRect(a,e,b,50,8,!0,!0);c.font="bold 48px EmbDigital";c.textAlign="left";c.textBaseline="top";c.fillStyle="#00A000";c.fillText(h,a+22,e);c.restore()};c.font="bold 48px EmbDigital";b=c.measureText("00:00").width+44;c.font="";d=c.createLinearGradient(a,e,a,e+50);d.addColorStop(0,"#fcfcfc");d.addColorStop(1,"#e1dfde");this.updateTime("00:00")}})();
(function(){mines.view.ViewGame=function(){mines.view.ViewGame.superclass.constructor.call(this);var a=mines.utils.Matrix,e=mines.utils.Collision,c=mines.utils.Dom,b=mines.utils.Event,d=mines.Constants,h=mines.view.Button,f=mines.view.Cell,l=mines.view.Face,n=mines.view.Clock,g=this,m=null,k=null,r,s,q,v,t,u,w,x;this.bBack=this.canvas=null;var B=function(){x?(g.canvas.addEventListener("touchstart",D),g.canvas.addEventListener("touchend",E),g.canvas.addEventListener("touchmove",F)):(g.canvas.addEventListener("click",
z),g.canvas.addEventListener("mousedown",A),g.canvas.addEventListener("mouseup",C),window.document.body.onselectstart=function(){return!1})},y=function(a,c){for(var b,d=r,f=s;d--;){for(;f--;)if(b=m[d][f],e.hitTestPoint(b,a,c))return b;f=s}return b},z=function(a){if(3!=a.which){var c=a.clientX+window.scrollX-k.x;a=a.clientY+window.scrollY-k.y;60<a?(g.dispatchEvent(b.CELL_CLICK,y(c,a)),clearTimeout(t)):e.hitTestPoint(g.bBack,c,a)&&g.dispatchEvent(b.BUTTON_CLICK,g.bBack)}},A=function(a){3==a.which?this.oncontextmenu=
function(){return!1}:60<a.clientY+window.scrollY-k.y&&g.dispatchEvent(b.CELL_MOUSE_DOWN)},C=function(a){3==a.which?(a=y(a.clientX+window.scrollX-k.x,a.clientY+window.scrollY-k.y),g.dispatchEvent(b.CELL_RIGHT_CLICK,a)):g.dispatchEvent(b.CELL_MOUSE_UP)},D=function(a){if(60<a.changedTouches[0].clientY+window.scrollY-k.y){g.dispatchEvent(b.CELL_MOUSE_DOWN);var c=y(a.changedTouches[0].clientX+window.scrollX-k.x,a.changedTouches[0].clientY+window.scrollY-k.y);t=setTimeout(function(){g.dispatchEvent(b.CELL_RIGHT_CLICK,
c);u=!0},900)}},E=function(a){if(u||w)u=w=!1,g.dispatchEvent(b.CELL_MOUSE_UP);else{var c=a.changedTouches[0].clientX+window.scrollX-k.x;a=a.changedTouches[0].clientY+window.scrollY-k.y;60<a?(g.dispatchEvent(b.CELL_CLICK,y(c,a)),clearTimeout(t)):e.hitTestPoint(g.bBack,c,a)&&g.dispatchEvent(b.BUTTON_CLICK,g.bBack)}},F=function(a){w=!0;clearTimeout(t)},G=function(){q.removeEventListener(b.LOADED,G);q.draw(d.FACE_SMILE)};this.init=function(d,e,g){var t=f.prototype.SIZE;this.canvas=document.getElementById(g);
this.canvas.width=t*d+20;this.canvas.height=t*e+80;k=c.getElementPosition(this.canvas);this.canvas.getContext("2d");s=d;r=e;x=!1;m=a.create(e,d);for(g=0;g<e;g++)for(var u=0;u<d;u++)m[g][u]=new f(g,u,g*t+3,u*t+63),m[g][u].draw(0,!1,!1,!1);q=new l((this.canvas.width-l.SIZE)/2,3);q.load();q.addEventListener(b.LOADED,G);this.bBack=new h("\u0412 \u043c\u0435\u043d\u044e",3,3,0,50);this.bBack.x=q.x-this.bBack.width-50;this.bBack.show();v=new n(q.x+q.SIZE+50,3);B()};this.destroy=function(){x?(g.canvas.removeEventListener("touchstart",
D),g.canvas.removeEventListener("touchend",E),g.canvas.removeEventListener("touchmove",F)):(g.canvas.removeEventListener("click",z),g.canvas.removeEventListener("mousedown",A),g.canvas.removeEventListener("mouseup",C))};this.getCell=function(a,c){return m[a][c]};this.drawMine=function(a,c){m[a][c].drawMine()};this.drawStrikeoutFlag=function(a,c){m[a][c].drawStrikeoutFlag()};this.redrawCell=function(a,c,b,d,f,e){this.getCell(a,c).draw(b,d,f,e)};this.redrawFace=function(a){q.draw(a)};this.updateTime=
function(a){v.updateTime(a)}};extend(mines.view.ViewGame,mines.utils.EventDispatcher)})();"undefined"!=typeof mines.view&&mines.view||(mines.view={});
(function(){var a=CONTEXT;mines.view.Label=function(a,c,b,d){this.text=a;this.x=c;this.y=b;this.font=d;this.width=0;this.color="#5e93bf";this.lineWidth=3;this.updateWidth()};mines.view.Label.prototype={draw:function(){a.save();a.font=this.font;a.strokeStyle="black";a.lineWidth=this.lineWidth;a.strokeText(this.text,this.x,this.y);a.fillStyle=this.color;a.fillText(this.text,this.x,this.y);a.restore()},updateWidth:function(){a.font=this.font;this.width=a.measureText(this.text).width;a.font=""}}})();
(function(){var a=CONTEXT;mines.view.Button=function(e,c,b,d,h){this.text=e;this.x=c;this.y=b;a.font="bold 24px Arial";this.width=0<d?d:a.measureText(this.text).width+2*this.paddingWidth;this.height=h};mines.view.Button.prototype={paddingWidth:40,paddingHeight:15,draw:function(){a.save();a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowBlur=5;a.shadowColor="rgba(0, 0, 0, 0.4)";a.fillStyle=this.pattern;a.lineWidth=2;a.strokeStyle="#9c9c9c";a.roundRect(this.x,this.y,this.width,this.height,7,!0,!0);a.font=
"bold 24px Arial";a.textBaseline="middle";a.fillStyle="#ffffff";a.fillText(this.text,this.x+this.paddingWidth,this.y+this.height/2);a.restore()},show:function(){this.draw()},createPattern:function(){var a=document.getElementById("canvas-pattern"),c=a.getContext("2d");c.beginPath();c.rect(0,0,4,4);c.rect(4,4,4,4);c.fillStyle="#5887af";c.fill();c.closePath();c.beginPath();c.rect(4,0,4,4);c.rect(0,4,4,4);c.fillStyle="#44759c";c.fill();c.closePath();this.pattern=c.createPattern(a,"repeat")}};mines.view.Button.prototype.createPattern()})();
(function(){mines.view.ViewMenu=function(){mines.view.ViewMenu.superclass.constructor.call(this);var a=mines.view.Button,e=mines.view.Label,c=mines.utils.Dom,b=mines.utils.Collision,d=mines.utils.Event,h=mines.utils.Animation,f=this,l=null,n=null,g=[],m=null,k=null;this.bBackResult=this.bReplay=this.lTextResult=this.lResult=this.bBackAbout=this.bSite=this.lTextAbout=this.lAbout=this.bBackRecords=this.lRecords=this.bBack=this.bR16C16M40=this.bR10C10M15=this.bR8C8M10=this.lChooseGame=this.bExit=this.bAbout=
this.bRecords=this.bNewGame=this.lMainMenu=this.canvasPosition=this.canvas=null;var r=function(){for(var a,c=!1,b=0,d=g.length,b=0;b<d;b++)g[b].toX=Math.round((f.canvas.width-g[b].width)/2),g[b].x=f.canvas.width;l.setStage(function(){a=1800*this.getTimeInterval()/1E3;c=!1;for(b=0;b<d;b++){var e=g[b];e.x>e.toX&&this.t>=100*b&&(e.x-=Math.round(a),e.x<e.toX&&(e.x=e.toX),c=!0)}c||l.stop();this.clear();n.drawImage(k,k.cX,(f.canvas.height-k.height)/2);m.draw();for(b=0;b<d;b++)g[b].draw(n)});l.start()},
s=function(){f.canvas.width=604<window.innerWidth?window.innerWidth:604;f.canvas.height=604<window.innerHeight?window.innerHeight:604},q=function(a){if(3!=a.which){var c=a.clientX+window.scrollX-f.canvasPosition.x;a=a.clientY+window.scrollY-f.canvasPosition.y;for(var e=0;e<g.length;e++)if(b.hitTestPoint(g[e],c,a)){f.dispatchEvent(d.BUTTON_CLICK,g[e]);break}}};this.init=function(){l=new h("canvas");this.canvas=l.getCanvas();n=l.getContext();s();this.canvasPosition=c.getElementPosition(this.canvas);
k=new Image;k.onload=function(){k.cX=(f.canvas.width-k.width)/2;k.cY=(f.canvas.height-k.height)/2;var c=(f.canvas.height-604)/2,b=c+50+60;f.lMainMenu=new e("\u0413\u043b\u0430\u0432\u043d\u043e\u0435 \u043c\u0435\u043d\u044e",0,b,'bold 52px "Comic Sans MS"');f.lMainMenu.x=Math.round((f.canvas.width-f.lMainMenu.width)/2);f.bNewGame=new a("\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430",f.canvas.width,b+=90,0,50);f.bRecords=new a("\u0420\u0435\u043a\u043e\u0440\u0434\u044b",f.canvas.width,
b+=70,0,50);f.bAbout=new a("\u041e\u0431 \u0438\u0433\u0440\u0435",f.canvas.width,b+=70,0,50);f.bExit=new a("\u0412\u044b\u0445\u043e\u0434",f.canvas.width,b+70,0,50);b=c+50+60;f.lChooseGame=new e("\u0412\u044b\u0431\u043e\u0440 \u0438\u0433\u0440\u044b",0,b,'bold 52px "Comic Sans MS"');f.lChooseGame.x=Math.round((f.canvas.width-f.lChooseGame.width)/2);f.bR8C8M10=new a("8 x 8 (10 \u043c\u0438\u043d)",f.canvas.width,b+=90,0,50);f.bR10C10M15=new a("10 x 10 (15 \u043c\u0438\u043d)",f.canvas.width,b+=
70,0,50);f.bR16C16M40=new a("16 x 16 (40 \u043c\u0438\u043d)",f.canvas.width,b+=70,0,50);f.bBack=new a("\u041d\u0430\u0437\u0430\u0434",f.canvas.width,b+70,0,50);b=c+50+60;f.lAbout=new e("\u041e\u0431 \u0438\u0433\u0440\u0435",0,b,'bold 52px "Comic Sans MS"');f.lAbout.x=Math.round((f.canvas.width-f.lAbout.width)/2);f.lTextAbout=new e("Author: Albul Alexandr \u00a9 special for",f.canvas.width,b+=90,'bold 26px "Comic Sans MS"');f.lTextAbout.lineWidth=2;f.bSite=new a("www.as3.com.ua",f.canvas.width,
b+=70,0,50);f.bBackAbout=new a("\u041d\u0430\u0437\u0430\u0434",f.canvas.width,b+70,0,50);b=c+50+60;f.lResult=new e("\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438 :(",0,b,'bold 52px "Comic Sans MS"');f.lResult.x=Math.round((f.canvas.width-f.lResult.width)/2);f.bBackRecords=new a("\u041d\u0430\u0437\u0430\u0434",f.canvas.width,b+70,0,50);b=c+50+60;f.lRecords=new e("\u0420\u0435\u043a\u043e\u0440\u0434\u044b",0,b,'bold 52px "Comic Sans MS"');f.lRecords.x=Math.round((f.canvas.width-
f.lRecords.width)/2);f.lTextResult=new e("\u0417\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438: ",0,b+=110,'bold 24px "Comic Sans MS"');f.lTextResult.x=Math.round((f.canvas.width-f.lTextResult.width)/2);f.lTextResult.lineWidth=2;f.bReplay=new a("\u0415\u0449\u0435 \u0440\u0430\u0437",f.canvas.width,b+=90,0,50);f.bBackResult=new a("\u041d\u0430\u0437\u0430\u0434",f.canvas.width,b+70,0,50);f.dispatchEvent("init")};k.src="../asset/bg.png";this.canvas.addEventListener("click",
q)};this.showChooseGame=function(){s();g=[];g.push(this.bR8C8M10,this.bR10C10M15,this.bR16C16M40,this.bBack);m=this.lChooseGame;r()};this.showMainMenu=function(){s();g=[];g.push(this.bNewGame,this.bRecords,this.bAbout,this.bExit);m=this.lMainMenu;r()};this.showAbout=function(){s();g=[];g.push(this.lTextAbout,this.bSite,this.bBackAbout);m=this.lAbout;r()};this.showRecords=function(){s();g=[];g.push(this.bBackRecords);m=this.lRecords;r()};this.showResult=function(a,b){s();g=[];g.push(this.lTextResult,
this.bReplay,this.bBackResult);m=this.lResult;this.lTextResult.text=b;this.lTextResult.updateWidth();a?(this.lResult.text="\u0412\u044b \u0432\u044b\u0438\u0433\u0440\u0430\u043b\u0438 :)",this.lResult.color="#78c14c"):(this.lResult.text="\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438 :(",this.lResult.color="#cf4b4b");this.lResult.updateWidth();r()};this.stopAnimation=function(){l.stop()}};extend(mines.view.ViewMenu,mines.utils.EventDispatcher)})();"undefined"!=typeof mines.presenter&&mines.presenter||(mines.presenter={});
(function(){mines.presenter.PresenterGame=function(){mines.presenter.PresenterGame.superclass.constructor.call(this);var a=mines.ModelGame,e=mines.view.ViewGame,c=mines.Constants,b=mines.utils.Event,d=null,h=null,f=null,l=this,n=function(a,b){h.redrawCell(a,b,d.getContentCell(a,b),d.isOpened(a,b),d.isMine(a,b),d.isMarked(a,b))},g=function(){for(var a=d.getRows(),c=d.getCols(),e=0;e<a;e++)for(var f=0;f<c;f++)d.isMine(e,f)&&!d.isMarked(e,f)&&h.drawMine(e,f),d.isMarked(e,f)&&!d.isMine(e,f)&&h.drawStrikeoutFlag(e,
f);h.removeEventListener(b.CELL_CLICK,m);h.removeEventListener(b.CELL_RIGHT_CLICK,k);h.removeEventListener(b.BUTTON_CLICK,q);h.removeEventListener(b.CELL_MOUSE_DOWN,r);h.removeEventListener(b.CELL_MOUSE_UP,s);d.removeEventListener(b.TIME_CHANGED,v);d.removeEventListener(b.CELL_MARKED,t);d.removeEventListener(b.CELLS_OPENED,u);d.removeEventListener(b.GAME_LOST,w);d.removeEventListener(b.GAME_WON,x);h.destroy()},m=function(a){d.tryOpenCell(a.i,a.j)},k=function(a){d.tryMarkCell(a.i,a.j)},r=function(){h.redrawFace(c.FACE_WORRIED)},
s=function(){h.redrawFace(c.FACE_SMILE)},q=function(a){"\u0412 \u043c\u0435\u043d\u044e"==a.text&&(d.quitGame(),g(),h.redrawFace(c.FACE_SAD),l.dispatchEvent(b.GAME_LOST))},v=function(a){h.updateTime(a)},t=function(a){h.redrawFace(c.FACE_SMILE);f.play();for(var b=a.length;b--;)n(a[b][0],a[b][1])},u=function(a){h.redrawFace(c.FACE_COOL);for(var b=a.length;b--;)n(a[b][0],a[b][1])},w=function(){g();h.redrawFace(c.FACE_SAD);l.dispatchEvent(b.GAME_LOST)},x=function(){g();h.redrawFace(c.FACE_WIN);l.dispatchEvent(b.GAME_WON)};
this.createNewGame=function(c,g,l){f=new Audio;f.setAttribute("src","../asset/marked.wav");f.load();d=new a;d.init(c,g,l);h=new e;h.init(d.getCols(),d.getRows(),"canvas");h.addEventListener(b.CELL_CLICK,m);h.addEventListener(b.CELL_RIGHT_CLICK,k);h.addEventListener(b.BUTTON_CLICK,q);h.addEventListener(b.CELL_MOUSE_DOWN,r);h.addEventListener(b.CELL_MOUSE_UP,s);d.addEventListener(b.TIME_CHANGED,v);d.addEventListener(b.CELL_MARKED,t);d.addEventListener(b.CELLS_OPENED,u);d.addEventListener(b.GAME_LOST,
w);d.addEventListener(b.GAME_WON,x)};this.getCols=function(){return d.getCols()};this.getRows=function(){return d.getRows()};this.getMines=function(){return d.getMines()};this.getTime=function(){return d.getTime()}};extend(mines.presenter.PresenterGame,mines.utils.EventDispatcher)})();"undefined"!=typeof mines.presenter&&mines.presenter||(mines.presenter={});
(function(){mines.presenter.PresenterMenu=function(){var a=mines.view.ViewMenu,e=mines.utils.Event,c=null,b=new mines.presenter.PresenterGame,d=null,h=function(a,d,f){c.stopAnimation();b.createNewGame(a,d,f);b.addEventListener(e.GAME_LOST,g);b.addEventListener(e.GAME_WON,m);c.removeEventListener(e.BUTTON_CLICK,n)},f=function(){b.removeEventListener(e.GAME_LOST,g);b.removeEventListener(e.GAME_WON,m);c.addEventListener(e.BUTTON_CLICK,n)},l=function(a){return"\u0417\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438: "+
Math.floor(a/60)+" \u043c\u0438\u043d "+Math.floor(a)+" \u0441\u0435\u043a"},n=function(a){switch(a.text){case "\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430":d.play();c.showChooseGame();break;case "\u0420\u0435\u043a\u043e\u0440\u0434\u044b":d.play();c.showRecords();break;case "\u041e\u0431 \u0438\u0433\u0440\u0435":d.play();c.showAbout();break;case "www.as3.com.ua":window.open("http://"+a.text,"_blank");break;case "8 x 8 (10 \u043c\u0438\u043d)":h(8,8,10);break;case "10 x 10 (15 \u043c\u0438\u043d)":h(10,
10,15);break;case "16 x 16 (40 \u043c\u0438\u043d)":h(16,16,40);break;case "\u0415\u0449\u0435 \u0440\u0430\u0437":h(b.getRows(),b.getCols(),b.getMines());break;case "\u041d\u0430\u0437\u0430\u0434":d.play(),c.showMainMenu()}},g=function(){setTimeout(function(){var a=l(b.getTime());d.play();c.showResult(!1,a);f()},2E3)},m=function(){setTimeout(function(){var a=l(b.getTime());d.play();c.showResult(!0,a);f()},2E3)},k=function(){d.play();c.showMainMenu()};this.init=function(){d=new Audio;d.setAttribute("src",
"../asset/slide.wav");d.load();c=new a;c.init();c.addEventListener("init",k);c.addEventListener(e.BUTTON_CLICK,n)}}})();var p=new mines.presenter.PresenterMenu;p.init();
