if("undefined"==typeof mines||!mines)var mines={};"undefined"!=typeof mines.utils&&mines.utils||(mines.utils={});function extend(a,f){var c=function(){};c.prototype=f.prototype;a.prototype=new c;a.prototype.constructor=a;a.superclass=f.prototype}Array.prototype.clone=function(){return this.slice(0)};
(function(){mines.utils.EventDispatcher=function(){var a={any:[]},f=function(c,b,d){var g=a.hasOwnProperty(b)?b:"any";b=a[g].clone();for(var g=a[g],e=0,f=b.length;e<f;e++)if("dispatch"===c)b[e](d);else g[e]===d&&g.splice(e,1)};this.addEventListener=function(c,b){c=c||"any";"undefined"===typeof a[c]&&(a[c]=[]);a[c].push(b)};this.removeEventListener=function(a,b){f("remove",a,b)};this.dispatchEvent=function(a,b){f("dispatch",a,b)}}})();
(function(){mines.utils.Event={LOADED:"loaded",GAME_WON:"gameWon",GAME_LOST:"gameLost",TIME_CHANGED:"timeChanged",DATA_MODIFIED:"dataModified",CELLS_OPENED:"cellsOpened",CELL_MARKED:"cellsMarked",CELL_CLICK:"cellClick",CELL_MOUSE_DOWN:"cellMouseDown",CELL_MOUSE_UP:"cellMouseUp",CELL_RIGHT_CLICK:"cellRightClick",BUTTON_CLICK:"buttonClick"}})();
(function(){mines.utils.Animation=function(a){this.canvas=document.getElementById(a);this.context=this.canvas.getContext("2d");this.frame=this.lastTime=this.startTime=this.timeInterval=this.t=0;this.animating=!1;this.instance=null;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}()};mines.utils.Animation.prototype=
{getContext:function(){return this.context},getCanvas:function(){return this.canvas},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},setStage:function(a){this.stage=a;this.t=0},isAnimating:function(){return this.animating},getFrame:function(){return this.frame},getTimeInterval:function(){return this.timeInterval},getTime:function(){return this.t},getFps:function(){return 0<this.timeInterval?1E3/this.timeInterval:0},start:function(){this.animating=!0;this.lastTime=
this.startTime=(new Date).getTime();void 0!==this.stage&&this.stage();this.animationLoop()},stop:function(){this.animating=!1},animationLoop:function(){if(this.animating){var a=this;this.frame++;var f=(new Date).getTime();this.timeInterval=f-this.lastTime;this.t+=this.timeInterval;this.lastTime=f;void 0!==this.stage&&this.stage();this.animating&&requestAnimFrame(function(){a.animationLoop()})}}}})();
(function(){mines.utils.ExtMath={getRandomInt:function(a,f){return Math.floor(Math.random()*(f-a+1))+a}}})();
(function(){var a=mines.utils.ExtMath,f=function(c,b,d){for(var g,e,f=d;f>=b;f--)g=a.getRandomInt(b,d),e=c[f],c[f]=c[g],c[g]=e;return c};mines.utils.ExtArray={create:function(a,b){if("undefined"==typeof b){for(var d=Array(a),g=a;g--;)d[g]=g+1;return d}d=Array(a);for(g=a;g--;)d[g]=b;return d},createRandom:function(c,b,d,g){for(var e=Array(d),f=d;f--;){for(d=a.getRandomInt(c,b);-1!=e.indexOf(d)||-1!=g.indexOf(d);)d=a.getRandomInt(c,b);e[f]=d}return e},shuffle:function(a,b,d){return"undefined"==typeof b||
"undefined"==typeof d?f(a,0,a.length-1):f(a,b,d)},amount:function(a,b){for(var d=0,g=a.length;g--;)a[g]==b&&d++;return d}}})();
(function(){var a=mines.utils.ExtMath,f=function(a,b){for(var d=a.length,g=a[0].length;d--;){for(;g--;)a[d][g]=b;g=a[0].length}};mines.utils.Matrix={create:function(a,b,d){a=Array(a);for(var g=a.length;g--;)a[g]=Array(b);"undefined"!=typeof d&&f(a,d);return a},fill:function(a,b){f(a,b)},fillRandom:function(c,b,d){for(var g=c.length-1,e=c[0].length-1,f,n;b;){f=a.getRandomInt(0,g);for(n=a.getRandomInt(0,e);c[f][n]==d;)f=a.getRandomInt(0,g),n=a.getRandomInt(0,e);c[f][n]=d;b--}}}})();
(function(){mines.utils.Collision={hitTestPoint:function(a,f,c){return a.x<f&&a.y<c&&a.x+a.width>f&&a.y+a.height>c?!0:!1}}})();(function(){mines.utils.Dom={getElementPosition:function(a){for(var f="",c=0,b=0;"object"==typeof a&&"undefined"!=typeof a.tagName;)b+=a.offsetTop,c+=a.offsetLeft,f=a.tagName.toUpperCase(),"BODY"==f&&(a=0),"object"==typeof a&&"object"==typeof a.offsetParent&&(a=a.offsetParent);return{x:c,y:b}}}})();mines.Constants={MINE:-1,ZERO:0,CLOSED_STATE:0,OPENED_STATE:1,MARKED_STATE:3,OVERFLOW:!1,STATE_DURING:0,STATE_WON:1,STATE_LOST:2,FACE_SMILE:1,FACE_WORRIED:2,FACE_COOL:3,FACE_SAD:4,FACE_WIN:5,BUTTON_HEIGHT:50};
(function(){mines.ModelGame=function(){mines.ModelGame.superclass.constructor.call(this);var a=mines.Constants,f=mines.utils.Matrix,c=mines.utils.Event,b,d,g=this,e,l,n,h,m,k,r,s,q,v,t,u,w,x=function(a,c){for(var b,d,e=1,f=[];8>=e;){switch(e){case 1:b=a-1;d=c;break;case 2:b=a+1;d=c;break;case 3:b=a;d=c-1;break;case 4:b=a;d=c+1;break;case 5:b=a-1;d=c-1;break;case 6:b=a-1;d=c+1;break;case 7:b=a+1;d=c-1;break;case 8:b=a+1,d=c+1}var g;g=0<=b&&b<v&&0<=d&&d<q?!0:!1;g&&f.push(b,d);e++}return f},B=function(a,
b){var d=0,c,e,f;f=x(a,b);for(var h=0,t=f.length;h<t;h+=2)c=f[h],e=f[h+1],g.isMine(c,e)&&d++;return d},y=function(a,d){z(a,d);if(g.isZero(a,d)||g.isMine(a,d)){var c,b,e;e=x(a,d);for(var f=0,h=e.length;f<h;f+=2)c=e[f],b=e[f+1],g.isMine(c,b)||g.isOpened(c,b)||y(c,b)}},z=function(c,b){g.isOpened(c,b)||(u--,d[c][b]=a.OPENED_STATE,w.push([c,b]))},A=function(){n=new Date;n>l&&(l=n,k=(l-e)/1E3,r=Math.floor(k/60),s=Math.floor(k%60),m=10<=r?r:"0"+r,m+=":",m+=10<=s?s:"0"+s,g.dispatchEvent(c.TIME_CHANGED,m));
h||setTimeout(A,1E3)};this.init=function(c,h,k){q=c;v=h;t=k;l=e=new Date;setTimeout(A,1E3);d=f.create(v,q,a.CLOSED_STATE);b=f.create(v,q,a.ZERO);f.fillRandom(b,t,a.MINE);u=v*q;w=[];c=q;for(h=v;c--;){for(;h--;)g.isMine(c,h)||g.setContentCell(c,h,B(c,h));h=q}};this.tryOpenCell=function(b,d){this.isOpened(b,d)||this.isMarked(b,d)||(w=[],z(b,d),this.isZero(b,d)&&y(b,d),this.dispatchEvent(c.CELLS_OPENED,w),this.isMine(b,d)&&(h=new Date,this.setStateGame(a.STATE_LOST),g.dispatchEvent(c.GAME_LOST)),u==this.getMines()&&
(h=new Date,this.setStateGame(a.STATE_WON),this.dispatchEvent(c.GAME_WON)))};this.tryMarkCell=function(b,d){this.isOpened(b,d)||(this.isMarked(b,d)?this.setStateCell(b,d,a.CLOSED_STATE):this.setStateCell(b,d,a.MARKED_STATE),w=[[b,d]],this.dispatchEvent(c.CELL_MARKED,w))};this.isOpened=function(b,c){return d[b][c]==a.OPENED_STATE};this.isMine=function(d,c){return b[d][c]==a.MINE};this.isMarked=function(b,c){return d[b][c]==a.MARKED_STATE};this.isZero=function(c,d){return b[c][d]==a.ZERO};this.getRows=
function(){return v};this.getCols=function(){return q};this.getMines=function(){return t};this.getContentCell=function(a,c){return b[a][c]};this.getTime=function(){if(h)return(h.getTime()-e.getTime())/1E3};this.setContentCell=function(a,c,d){b[a][c]=d};this.setStateCell=function(a,c,b){d[a][c]=b};this.setStateGame=function(a){};this.quitGame=function(){h=new Date;this.setStateGame(a.STATE_LOST)}};extend(mines.ModelGame,mines.utils.EventDispatcher)})();var CONTEXT=document.getElementById("canvas").getContext("2d");CanvasRenderingContext2D.prototype.roundRect=function(a,f,c,b,d,g,e){c<2*d&&(d=c/2);b<2*d&&(d=b/2);this.beginPath();this.moveTo(a+d,f);this.arcTo(a+c,f,a+c,f+b,d);this.arcTo(a+c,f+b,a,f+b,d);this.arcTo(a,f+b,a,f,d);this.arcTo(a,f,a+c,f,d);this.closePath();g&&this.fill();e&&this.stroke()};"undefined"!=typeof mines.view&&mines.view||(mines.view={});
(function(){var a=CONTEXT;mines.view.Cell=function(a,c,b,d){this.i=a;this.j=c;this.x=b;this.y=d};mines.view.Cell.prototype={TOP_COLOR_OPENED:"#fcfcfc",BOTTOM_COLOR_OPENED:"#e1dfde",TOP_COLOR_CLOSED:"#8cb0dc",BOTTOM_COLOR_CLOSED:"#7aa1d2",MINE_COLOR_FILL:"#7B7B7B",MINE_COLOR_STROKE:"#121212",COLORS_NUMBER:"#0000FF #00A000 #FF0000 #00007F #A00000 #00CCFF #A000A0 #000000".split(" "),SIZE:60,FONT_SIZE:54,THORN_HEIGHT:8,width:60,height:60,imgFlag:null,imgMine:null,drawMine:function(){var f=this.x+this.SIZE/
2,c=this.y+this.SIZE/2,b=this.SIZE/3.5,d=2*Math.PI,g,e,l,n;g=a.createRadialGradient(f-4,c-2,0,f-4,c-2,b);g.addColorStop(0,this.MINE_COLOR_FILL);g.addColorStop(1,this.MINE_COLOR_STROKE);a.beginPath();a.arc(f,c,b,0,2*Math.PI,!1);a.fillStyle=g;a.fill();a.lineWidth=5;a.strokeStyle=this.MINE_COLOR_STROKE;for(a.stroke();d;)g=f+b*Math.cos(d),e=c+b*Math.sin(d),l=f+(b+this.THORN_HEIGHT)*Math.cos(d),n=c+(b+this.THORN_HEIGHT)*Math.sin(d),a.beginPath(),a.moveTo(g,e),a.lineTo(l,n),a.stroke(),d-=Math.PI/4;a.moveTo(f,
c-this.THORN_HEIGHT/4);a.lineTo(f,c+this.THORN_HEIGHT/4);a.stroke()},drawFlag:function(){a.drawImage(this.imgFlag,this.x+2,this.y+2)},drawStrikeoutFlag:function(){a.save();a.lineWidth=6;a.strokeStyle=this.MINE_COLOR_STROKE;a.lineCap="round";a.beginPath();a.moveTo(this.x+5,this.y+5);a.lineTo(this.x+this.SIZE-8,this.y+this.SIZE-8);a.moveTo(this.x+this.SIZE-8,this.y+5);a.lineTo(this.x+5,this.y+this.SIZE-8);a.stroke();a.closePath();a.restore()},draw:function(f,c,b,d){var g=a.createLinearGradient(this.x,
this.y,this.x,this.y+this.SIZE);a.save();c?(g.addColorStop(0,this.TOP_COLOR_OPENED),g.addColorStop(1,this.BOTTOM_COLOR_OPENED)):(g.addColorStop(0,this.TOP_COLOR_CLOSED),g.addColorStop(1,this.BOTTOM_COLOR_CLOSED));a.lineWidth=1;a.fillStyle=g;a.strokeStyle="#7d838c";a.roundRect(this.x,this.y,this.SIZE,this.SIZE,6,!0,!1);a.roundRect(this.x-1,this.y-1,this.SIZE,this.SIZE,6,!1,!0);c?("undefined"!=typeof f&&0<f&&(a.font="bold "+this.FONT_SIZE+"px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle=
this.COLORS_NUMBER[(f-1)%this.COLORS_NUMBER.length],a.fillText(f.toString(),this.x+this.SIZE/2,this.y+this.SIZE/2)),b&&this.drawMine()):d&&this.drawFlag();a.restore()},load:function(){this.imgFlag=new Image;this.imgFlag.src="../asset/flag.png";this.imgMine=new Image;this.imgMine.src="../asset/mine.png"}};mines.view.Cell.prototype.load()})();
(function(){mines.view.Face=function(a,f){mines.view.Face.superclass.constructor.call(this);var c=mines.Constants,b=mines.utils.Event,d=0,g=this,e=CONTEXT,l=null,n=null,h=null,m=null,k=null;this.x=a;this.y=f;this.SIZE=50;var r=function(){d++;5==d&&g.dispatchEvent(b.LOADED)};this.load=function(){l=new Image;l.src="../asset/face-smile.png";l.onload=r;n=new Image;n.src="../asset/face-worried.png";n.onload=r;m=new Image;m.src="../asset/face-cool.png";m.onload=r;h=new Image;h.src="../asset/face-sad.png";
h.onload=r;k=new Image;k.src="../asset/face-win.png";k.onload=r};this.draw=function(a){e.clearRect(this.x,this.y,this.SIZE,this.SIZE);switch(a){case c.FACE_SMILE:e.drawImage(l,this.x,this.y);break;case c.FACE_WORRIED:e.drawImage(n,this.x,this.y);break;case c.FACE_COOL:e.drawImage(m,this.x,this.y);break;case c.FACE_SAD:e.drawImage(h,this.x,this.y);break;case c.FACE_WIN:e.drawImage(k,this.x,this.y)}}};mines.view.Face.SIZE=50;extend(mines.view.Face,mines.utils.EventDispatcher)})();
(function(){mines.view.Clock=function(a,f){var c=CONTEXT,b=0,d,g,e;this.updateTime=function(g){c.save();c.lineWidth=2;c.strokeStyle="#9c9c9c";c.fillStyle=d;c.roundRect(a,f,b,50,8,!0,!0);c.font="bold 48px EmbDigital";c.textAlign="left";c.textBaseline=e;c.fillStyle="#00A000";c.fillText(g,a+22,f);c.restore()};c.font="bold 48px EmbDigital";b=c.measureText("00:00").width+44;c.font="";d=c.createLinearGradient(a,f,a,f+50);d.addColorStop(0,"#fcfcfc");d.addColorStop(1,"#e1dfde");g=navigator.userAgent.toLowerCase();
e=function(a){return a.test(g)}(/firefox/)?"middle":"top";this.updateTime("00:00")}})();
(function(){mines.view.ViewGame=function(){mines.view.ViewGame.superclass.constructor.call(this);var a=mines.utils.Matrix,f=mines.utils.Collision,c=mines.utils.Dom,b=mines.utils.Event,d=mines.Constants,g=mines.view.Button,e=mines.view.Cell,l=mines.view.Face,n=mines.view.Clock,h=this,m=null,k=null,r,s,q,v,t,u,w,x;this.bBack=this.canvas=null;var B=function(){x?(h.canvas.addEventListener("touchstart",D),h.canvas.addEventListener("touchend",E),h.canvas.addEventListener("touchmove",F)):(h.canvas.addEventListener("click",
z),h.canvas.addEventListener("mousedown",A),h.canvas.addEventListener("mouseup",C),window.document.body.onselectstart=function(){return!1})},y=function(a,c){for(var b,d=r,e=s;d--;){for(;e--;)if(b=m[d][e],f.hitTestPoint(b,a,c))return b;e=s}return b},z=function(a){if(3!=a.which){var c=a.clientX+window.scrollX-k.x;a=a.clientY+window.scrollY-k.y;60<a?(h.dispatchEvent(b.CELL_CLICK,y(c,a)),clearTimeout(t)):f.hitTestPoint(h.bBack,c,a)&&h.dispatchEvent(b.BUTTON_CLICK,h.bBack)}},A=function(a){3==a.which?this.oncontextmenu=
function(){return!1}:60<a.clientY+window.scrollY-k.y&&h.dispatchEvent(b.CELL_MOUSE_DOWN)},C=function(a){3==a.which?(a=y(a.clientX+window.scrollX-k.x,a.clientY+window.scrollY-k.y),h.dispatchEvent(b.CELL_RIGHT_CLICK,a)):h.dispatchEvent(b.CELL_MOUSE_UP)},D=function(a){if(60<a.changedTouches[0].clientY+window.scrollY-k.y){h.dispatchEvent(b.CELL_MOUSE_DOWN);var c=y(a.changedTouches[0].clientX+window.scrollX-k.x,a.changedTouches[0].clientY+window.scrollY-k.y);t=setTimeout(function(){h.dispatchEvent(b.CELL_RIGHT_CLICK,
c);u=!0},900)}},E=function(a){if(u||w)u=w=!1,h.dispatchEvent(b.CELL_MOUSE_UP);else{var c=a.changedTouches[0].clientX+window.scrollX-k.x;a=a.changedTouches[0].clientY+window.scrollY-k.y;60<a?(h.dispatchEvent(b.CELL_CLICK,y(c,a)),clearTimeout(t)):f.hitTestPoint(h.bBack,c,a)&&h.dispatchEvent(b.BUTTON_CLICK,h.bBack)}},F=function(a){w=!0;clearTimeout(t)},G=function(){q.removeEventListener(b.LOADED,G);q.draw(d.FACE_SMILE)};this.init=function(d,f,h){var t=e.prototype.SIZE;this.canvas=document.getElementById(h);
this.canvas.width=t*d+20;this.canvas.height=t*f+80;k=c.getElementPosition(this.canvas);this.canvas.getContext("2d");s=d;r=f;x=!1;m=a.create(f,d);for(h=0;h<f;h++)for(var u=0;u<d;u++)m[h][u]=new e(h,u,h*t+3,u*t+63),m[h][u].draw(0,!1,!1,!1);q=new l((this.canvas.width-l.SIZE)/2,3);q.load();q.addEventListener(b.LOADED,G);this.bBack=new g("\u0412 \u043c\u0435\u043d\u044e",3,3,0,50);this.bBack.x=q.x-this.bBack.width-50;this.bBack.show();v=new n(q.x+q.SIZE+50,3);B()};this.destroy=function(){x?(h.canvas.removeEventListener("touchstart",
D),h.canvas.removeEventListener("touchend",E),h.canvas.removeEventListener("touchmove",F)):(h.canvas.removeEventListener("click",z),h.canvas.removeEventListener("mousedown",A),h.canvas.removeEventListener("mouseup",C))};this.getCell=function(a,c){return m[a][c]};this.drawMine=function(a,c){m[a][c].drawMine()};this.drawStrikeoutFlag=function(a,c){m[a][c].drawStrikeoutFlag()};this.redrawCell=function(a,c,b,d,e,f){this.getCell(a,c).draw(b,d,e,f)};this.redrawFace=function(a){q.draw(a)};this.updateTime=
function(a){v.updateTime(a)}};extend(mines.view.ViewGame,mines.utils.EventDispatcher)})();"undefined"!=typeof mines.view&&mines.view||(mines.view={});
(function(){var a=CONTEXT;mines.view.Label=function(a,c,b,d){this.text=a;this.x=c;this.y=b;this.font=d;this.width=0;this.color="#5e93bf";this.lineWidth=3;this.updateWidth()};mines.view.Label.prototype={draw:function(){a.save();a.font=this.font;a.strokeStyle="black";a.lineWidth=this.lineWidth;a.strokeText(this.text,this.x,this.y);a.fillStyle=this.color;a.fillText(this.text,this.x,this.y);a.restore()},updateWidth:function(){a.font=this.font;this.width=a.measureText(this.text).width;a.font=""}}})();
(function(){var a=CONTEXT;mines.view.Button=function(f,c,b,d,g){this.text=f;this.x=c;this.y=b;a.font="bold 24px Arial";this.width=0<d?d:a.measureText(this.text).width+2*this.paddingWidth;this.height=g};mines.view.Button.prototype={paddingWidth:40,paddingHeight:15,draw:function(){a.save();a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowBlur=5;a.shadowColor="rgba(0, 0, 0, 0.4)";a.fillStyle=this.pattern;a.lineWidth=2;a.strokeStyle="#9c9c9c";a.roundRect(this.x,this.y,this.width,this.height,7,!0,!0);a.font=
"bold 24px Arial";a.textBaseline="middle";a.fillStyle="#ffffff";a.fillText(this.text,this.x+this.paddingWidth,this.y+this.height/2);a.restore()},show:function(){this.draw()},createPattern:function(){var a=document.getElementById("canvas-pattern"),c=a.getContext("2d");c.beginPath();c.rect(0,0,4,4);c.rect(4,4,4,4);c.fillStyle="#5887af";c.fill();c.closePath();c.beginPath();c.rect(4,0,4,4);c.rect(0,4,4,4);c.fillStyle="#44759c";c.fill();c.closePath();this.pattern=c.createPattern(a,"repeat")}};mines.view.Button.prototype.createPattern()})();
(function(){mines.view.ViewMenu=function(){mines.view.ViewMenu.superclass.constructor.call(this);var a=mines.view.Button,f=mines.view.Label,c=mines.utils.Dom,b=mines.utils.Collision,d=mines.utils.Event,g=mines.utils.Animation,e=this,l=null,n=null,h=[],m=null,k=null;this.bBackResult=this.bReplay=this.lTextResult=this.lResult=this.bBackAbout=this.bSite=this.lTextAbout=this.lAbout=this.bBackRecords=this.lRecords=this.bBack=this.bR16C16M40=this.bR10C10M15=this.bR8C8M10=this.lChooseGame=this.bExit=this.bAbout=
this.bRecords=this.bNewGame=this.lMainMenu=this.canvasPosition=this.canvas=null;var r=function(){for(var a,c=!1,b=0,d=h.length,b=0;b<d;b++)h[b].toX=Math.round((e.canvas.width-h[b].width)/2),h[b].x=e.canvas.width;l.setStage(function(){a=1800*this.getTimeInterval()/1E3;c=!1;for(b=0;b<d;b++){var f=h[b];f.x>f.toX&&this.t>=100*b&&(f.x-=Math.round(a),f.x<f.toX&&(f.x=f.toX),c=!0)}c||l.stop();this.clear();n.drawImage(k,k.cX,(e.canvas.height-k.height)/2);m.draw();for(b=0;b<d;b++)h[b].draw(n)});l.start()},
s=function(){e.canvas.width=604<window.innerWidth?window.innerWidth:604;e.canvas.height=604<window.innerHeight?window.innerHeight:604},q=function(a){if(3!=a.which){var c=a.clientX+window.scrollX-e.canvasPosition.x;a=a.clientY+window.scrollY-e.canvasPosition.y;for(var f=0;f<h.length;f++)if(b.hitTestPoint(h[f],c,a)){e.dispatchEvent(d.BUTTON_CLICK,h[f]);break}}};this.init=function(){l=new g("canvas");this.canvas=l.getCanvas();n=l.getContext();s();this.canvasPosition=c.getElementPosition(this.canvas);
k=new Image;k.onload=function(){k.cX=(e.canvas.width-k.width)/2;k.cY=(e.canvas.height-k.height)/2;var c=(e.canvas.height-604)/2,b=c+50+60;e.lMainMenu=new f("\u0413\u043b\u0430\u0432\u043d\u043e\u0435 \u043c\u0435\u043d\u044e",0,b,'bold 52px "Comic Sans MS"');e.lMainMenu.x=Math.round((e.canvas.width-e.lMainMenu.width)/2);e.bNewGame=new a("\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430",e.canvas.width,b+=90,0,50);e.bRecords=new a("\u0420\u0435\u043a\u043e\u0440\u0434\u044b",e.canvas.width,
b+=70,0,50);e.bAbout=new a("\u041e\u0431 \u0438\u0433\u0440\u0435",e.canvas.width,b+=70,0,50);e.bExit=new a("\u0412\u044b\u0445\u043e\u0434",e.canvas.width,b+70,0,50);b=c+50+60;e.lChooseGame=new f("\u0412\u044b\u0431\u043e\u0440 \u0438\u0433\u0440\u044b",0,b,'bold 52px "Comic Sans MS"');e.lChooseGame.x=Math.round((e.canvas.width-e.lChooseGame.width)/2);e.bR8C8M10=new a("8 x 8 (10 \u043c\u0438\u043d)",e.canvas.width,b+=90,0,50);e.bR10C10M15=new a("10 x 10 (15 \u043c\u0438\u043d)",e.canvas.width,b+=
70,0,50);e.bR16C16M40=new a("16 x 16 (40 \u043c\u0438\u043d)",e.canvas.width,b+=70,0,50);e.bBack=new a("\u041d\u0430\u0437\u0430\u0434",e.canvas.width,b+70,0,50);b=c+50+60;e.lAbout=new f("\u041e\u0431 \u0438\u0433\u0440\u0435",0,b,'bold 52px "Comic Sans MS"');e.lAbout.x=Math.round((e.canvas.width-e.lAbout.width)/2);e.lTextAbout=new f("Author: Albul Alexandr \u00a9 special for",e.canvas.width,b+=90,'bold 26px "Comic Sans MS"');e.lTextAbout.lineWidth=2;e.bSite=new a("www.as3.com.ua",e.canvas.width,
b+=70,0,50);e.bBackAbout=new a("\u041d\u0430\u0437\u0430\u0434",e.canvas.width,b+70,0,50);b=c+50+60;e.lResult=new f("\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438 :(",0,b,'bold 52px "Comic Sans MS"');e.lResult.x=Math.round((e.canvas.width-e.lResult.width)/2);e.bBackRecords=new a("\u041d\u0430\u0437\u0430\u0434",e.canvas.width,b+70,0,50);b=c+50+60;e.lRecords=new f("\u0420\u0435\u043a\u043e\u0440\u0434\u044b",0,b,'bold 52px "Comic Sans MS"');e.lRecords.x=Math.round((e.canvas.width-
e.lRecords.width)/2);e.lTextResult=new f("\u0417\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438: ",0,b+=110,'bold 24px "Comic Sans MS"');e.lTextResult.x=Math.round((e.canvas.width-e.lTextResult.width)/2);e.lTextResult.lineWidth=2;e.bReplay=new a("\u0415\u0449\u0435 \u0440\u0430\u0437",e.canvas.width,b+=90,0,50);e.bBackResult=new a("\u041d\u0430\u0437\u0430\u0434",e.canvas.width,b+70,0,50);e.dispatchEvent("init")};k.src="../asset/bg.png";this.canvas.addEventListener("click",
q)};this.showChooseGame=function(){s();h=[];h.push(this.bR8C8M10,this.bR10C10M15,this.bR16C16M40,this.bBack);m=this.lChooseGame;r()};this.showMainMenu=function(){s();h=[];h.push(this.bNewGame,this.bRecords,this.bAbout,this.bExit);m=this.lMainMenu;r()};this.showAbout=function(){s();h=[];h.push(this.lTextAbout,this.bSite,this.bBackAbout);m=this.lAbout;r()};this.showRecords=function(){s();h=[];h.push(this.bBackRecords);m=this.lRecords;r()};this.showResult=function(a,b){s();h=[];h.push(this.lTextResult,
this.bReplay,this.bBackResult);m=this.lResult;this.lTextResult.text=b;this.lTextResult.updateWidth();a?(this.lResult.text="\u0412\u044b \u0432\u044b\u0438\u0433\u0440\u0430\u043b\u0438 :)",this.lResult.color="#78c14c"):(this.lResult.text="\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438 :(",this.lResult.color="#cf4b4b");this.lResult.updateWidth();r()};this.stopAnimation=function(){l.stop()}};extend(mines.view.ViewMenu,mines.utils.EventDispatcher)})();"undefined"!=typeof mines.presenter&&mines.presenter||(mines.presenter={});
(function(){mines.presenter.PresenterGame=function(){mines.presenter.PresenterGame.superclass.constructor.call(this);var a=mines.ModelGame,f=mines.view.ViewGame,c=mines.Constants,b=mines.utils.Event,d=null,g=null,e=null,l=this,n=function(a,b){g.redrawCell(a,b,d.getContentCell(a,b),d.isOpened(a,b),d.isMine(a,b),d.isMarked(a,b))},h=function(){for(var a=d.getRows(),c=d.getCols(),f=0;f<a;f++)for(var e=0;e<c;e++)d.isMine(f,e)&&!d.isMarked(f,e)&&g.drawMine(f,e),d.isMarked(f,e)&&!d.isMine(f,e)&&g.drawStrikeoutFlag(f,
e);g.removeEventListener(b.CELL_CLICK,m);g.removeEventListener(b.CELL_RIGHT_CLICK,k);g.removeEventListener(b.BUTTON_CLICK,q);g.removeEventListener(b.CELL_MOUSE_DOWN,r);g.removeEventListener(b.CELL_MOUSE_UP,s);d.removeEventListener(b.TIME_CHANGED,v);d.removeEventListener(b.CELL_MARKED,t);d.removeEventListener(b.CELLS_OPENED,u);d.removeEventListener(b.GAME_LOST,w);d.removeEventListener(b.GAME_WON,x);g.destroy()},m=function(a){d.tryOpenCell(a.i,a.j)},k=function(a){d.tryMarkCell(a.i,a.j)},r=function(){g.redrawFace(c.FACE_WORRIED)},
s=function(){g.redrawFace(c.FACE_SMILE)},q=function(a){"\u0412 \u043c\u0435\u043d\u044e"==a.text&&(d.quitGame(),h(),g.redrawFace(c.FACE_SAD),l.dispatchEvent(b.GAME_LOST))},v=function(a){g.updateTime(a)},t=function(a){g.redrawFace(c.FACE_SMILE);e.play();for(var b=a.length;b--;)n(a[b][0],a[b][1])},u=function(a){g.redrawFace(c.FACE_COOL);for(var b=a.length;b--;)n(a[b][0],a[b][1])},w=function(){h();g.redrawFace(c.FACE_SAD);l.dispatchEvent(b.GAME_LOST)},x=function(){h();g.redrawFace(c.FACE_WIN);l.dispatchEvent(b.GAME_WON)};
this.createNewGame=function(c,h,l){e=new Audio;e.setAttribute("src","../asset/marked.wav");e.load();d=new a;d.init(c,h,l);g=new f;g.init(d.getCols(),d.getRows(),"canvas");g.addEventListener(b.CELL_CLICK,m);g.addEventListener(b.CELL_RIGHT_CLICK,k);g.addEventListener(b.BUTTON_CLICK,q);g.addEventListener(b.CELL_MOUSE_DOWN,r);g.addEventListener(b.CELL_MOUSE_UP,s);d.addEventListener(b.TIME_CHANGED,v);d.addEventListener(b.CELL_MARKED,t);d.addEventListener(b.CELLS_OPENED,u);d.addEventListener(b.GAME_LOST,
w);d.addEventListener(b.GAME_WON,x)};this.getCols=function(){return d.getCols()};this.getRows=function(){return d.getRows()};this.getMines=function(){return d.getMines()};this.getTime=function(){return d.getTime()}};extend(mines.presenter.PresenterGame,mines.utils.EventDispatcher)})();"undefined"!=typeof mines.presenter&&mines.presenter||(mines.presenter={});
(function(){mines.presenter.PresenterMenu=function(){var a=mines.view.ViewMenu,f=mines.utils.Event,c=null,b=new mines.presenter.PresenterGame,d=null,g=function(a,d,e){c.stopAnimation();b.createNewGame(a,d,e);b.addEventListener(f.GAME_LOST,h);b.addEventListener(f.GAME_WON,m);c.removeEventListener(f.BUTTON_CLICK,n)},e=function(){b.removeEventListener(f.GAME_LOST,h);b.removeEventListener(f.GAME_WON,m);c.addEventListener(f.BUTTON_CLICK,n)},l=function(a){return"\u0417\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438: "+
Math.floor(a/60)+" \u043c\u0438\u043d "+Math.floor(a)+" \u0441\u0435\u043a"},n=function(a){switch(a.text){case "\u041d\u043e\u0432\u0430\u044f \u0438\u0433\u0440\u0430":d.play();c.showChooseGame();break;case "\u0420\u0435\u043a\u043e\u0440\u0434\u044b":d.play();c.showRecords();break;case "\u041e\u0431 \u0438\u0433\u0440\u0435":d.play();c.showAbout();break;case "www.as3.com.ua":window.open("http://"+a.text,"_blank");break;case "8 x 8 (10 \u043c\u0438\u043d)":g(8,8,10);break;case "10 x 10 (15 \u043c\u0438\u043d)":g(10,
10,15);break;case "16 x 16 (40 \u043c\u0438\u043d)":g(16,16,40);break;case "\u0415\u0449\u0435 \u0440\u0430\u0437":g(b.getRows(),b.getCols(),b.getMines());break;case "\u041d\u0430\u0437\u0430\u0434":d.play(),c.showMainMenu()}},h=function(){setTimeout(function(){var a=l(b.getTime());d.play();c.showResult(!1,a);e()},2E3)},m=function(){setTimeout(function(){var a=l(b.getTime());d.play();c.showResult(!0,a);e()},2E3)},k=function(){d.play();c.showMainMenu()};this.init=function(){d=new Audio;d.setAttribute("src",
"../asset/slide.wav");d.load();c=new a;c.init();c.addEventListener("init",k);c.addEventListener(f.BUTTON_CLICK,n)}}})();var p=new mines.presenter.PresenterMenu;p.init();
